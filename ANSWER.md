# Яндекс практика - Тестовое здание

Едисеев Максим @vees1de

## Замечания

1. Бинарник имитатора лежит в `smart_socket/imitator/src/lib.rs`. Точкой входа бинарного приложения должен быть `main.rs`, из-за этого структура проекта получается нетипичной.
   Нужно переименовать файл `smart_socket/imitator/src/lib.rs` в `main.rs`, чтобы имитатор собирался как стандартное бинарное приложение.

---

2. Сервер обрабатывает соединения последовательно, без многопоточности. При одном «подвисшем» или долгом клиенте весь сервер блокируется и не может обслуживать другие подключения.  
   Можно вынести состояние розетки в общий объект (`SmartSocket`), обернуть его в `Arc<Mutex<T>>` и обрабатывать каждое подключение в отдельном потоке, разделяя доступ к состоянию через мьютекс.

---

3. Протокол (типы `Command`, `Response` и преобразования в байты) дублируется в двух крейтах — клиенте и имитаторе. При любом изменении протокола есть риск обновить только одну сторону, что приведёт к рассинхронизации и багам.  
   Нужно вынести описание протокола в отдельный crate `protocol` и подключать его и на стороне клиента, и на стороне имитатора, чтобы оба использовали один и тот же источник истины.

---

4. Отсутствуют таймауты на чтение/запись в TCP и подробный вывод ошибок. Клиент или сервер могут зависнуть на операции ввода-вывода, при этом будет сложно понять, на каком этапе всё сломалось и почему.
   Можно настроить `read_timeout` и `write_timeout` для `TcpStream`/`TcpListener`, использовать осмысленный тип ошибок и логирование (например, через `thiserror` + `log`/`tracing`), чтобы выводить понятные сообщения при сетевых и протокольных сбоях.
